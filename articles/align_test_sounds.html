<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Synthesize and align test sounds • baRulho</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Synthesize and align test sounds">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">baRulho</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/align_test_sounds.html">Synthesize and align test sounds</a></li>
    <li><a class="dropdown-item" href="../articles/quantify_degradation.html">Quantify degradation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/baRulho/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Synthesize and align test sounds</h1>
                        <h4 data-toc-skip class="author"><a href="https://marce10.github.io/" class="external-link">Marcelo
Araya-Salas, PhD</a></h4>
            
            <h4 data-toc-skip class="date">2025-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/baRulho/blob/master/vignettes/align_test_sounds.Rmd" class="external-link"><code>vignettes/align_test_sounds.Rmd</code></a></small>
      <div class="d-none name"><code>align_test_sounds.Rmd</code></div>
    </div>

    
    
<p> </p>
<p>This vignette deals with two things: how to create synthetic sounds
for playback experiments and how to align re-recorded sounds to their
reference once playback has been conducted. Here is some terms that will
be used in this vignettes and throughout the package.</p>
<p> </p>
<div class="section level2">
<h2 id="glossary">Glossary<a class="anchor" aria-label="anchor" href="#glossary"></a>
</h2>
<p><img src="baRulho_sticker.png" alt="baRulho sticker" align="right" width="25%" height="25%"></p>
<p>-<strong>Model sound</strong>: sound in which transmission properties
will be studied, usually found in the original field recordings or
synthetic sound files.</p>
<p>-<strong>Reference sound</strong>: sound to use as a pattern to
compare against. Usually created by re-recording a model sound broadcast
at 1 m from the source (speaker).</p>
<p>-<strong>Sound ID</strong>: ID of sounds used to identify
counterparts across distances. Each sound must have a unique ID within a
distance.</p>
<p>-<strong>Ambient noise</strong>: energy from background sounds in the
recording, excluding sounds of interest.</p>
<p>-<strong>Test sound</strong>: sounds re-recorded far from the source
to test for transmission/degradation (also refer to as ‘re-recorded’
sounds).</p>
<p>-<strong>Degradation</strong>: loose term used to describe any
changes in the structure of a sound when transmitted in a habitat.</p>
</div>
<p> </p>
<p>Note the use of the syntax <code>package_name::function()</code> in
the code throughout the vignette to explicitly identify the packages
each function belongs to.</p>
<hr>
<div class="section level2">
<h2 id="synthesize-sounds">Synthesize sounds<a class="anchor" aria-label="anchor" href="#synthesize-sounds"></a>
</h2>
<p>We often want to figure out how transmission properties vary across a
range of frequencies. For instance, Tobias et al (2010) studied whether
acoustic adaptation (a special case of sensory drive; Morton 1975),
could explain song evolution in Amazonian avian communities. To test
this the authors created synthetic pure tone sounds that were used as
playback and re-recorded in different habitats. This is the actual
procedure of creating synthetic sounds as they described it:</p>
<blockquote>
<p>“Tones were synthesized at six different frequencies (0.5, 1.0, 2.0,
3.0, 4.0, and 5.0 kHz) to encompass the range of maximum avian auditory
sensitivity (Dooling 1982). At each frequency, we generated two
sequences of two 100-msec tones. One sequence had a relatively short
interval of 150 msec, close to the mean internote interval in our sample
(152± 4 msec). The other sequence had a longer interval of 250 msec,
close to the mean maximum internote interval in our sample (283± 74
msec). The first sequence reflects a fast-paced song and the second a
slower paced song (sensu Slabbekoorn et al. 2007). The master file
(44100 Hz/16 bit WAV) thereby consisted of a series of 12 pairs of
artificial 100-ms constant-frequency tones at six different frequencies
(0.5, 1.0, 2.0, 3.0, 4.0, and 5.0 kHz).”</p>
</blockquote>
<p>We can synthesize the same pure tones using the function
<code><a href="../reference/synth_sounds.html">synth_sounds()</a></code>. The function requires 1) the frequencies of
tones to synthesize (argument <code>frequencies</code>, in kHz) and 2)
the duration of the tones (<code>durations</code>, in seconds). In
addition, logical arguments <code>fm</code> and <code>am</code> allow to
create frequency and amplitude modulated sounds respectively. In our
case we need six tones of 100 ms at 0.5, 1, 2, 3, 4, and 5 kHz separated
by intervals of 150 ms (at least for the first synthetic file described
in Tobias et al 2010). We can also get a selection table (sensu <a href="https://cran.r-project.org/package=warbleR" class="external-link">warbleR</a>) with the
information about the time and frequency location of every sound. This
would be required in order to make the master sound file. To get the
selection table we need to set the argument
<code>selec.table = TRUE</code>. This can be done as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>Loading required package: viridisLite</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/baRulho" class="external-link">baRulho</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>Loading required package: warbleR</code></pre>
<pre><code>Loading required package: tuneR</code></pre>
<pre><code>Loading required package: seewave</code></pre>
<pre><code>Loading required package: NatureSounds</code></pre>
<pre><code>Loading required package: ohun</code></pre>
<pre><code>
Please cite 'ohun' as: </code></pre>
<pre><code> Araya-Salas, M., Smith-Vidaurre, G., Chaverri, G., Brenes, J. C., Chirino, F., Elizondo-Calvo, J., &amp; Rico-Guevara, A. 2023. ohun: an R package for diagnosing and optimizing automatic sound event detection. Methods in Ecology and Evolution. https://doi.org/10.1111/2041-210X.14170</code></pre>
<pre><code>
Please cite 'baRulho' as: </code></pre>
<pre><code>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.</code></pre>
<pre><code>
Attaching package: 'baRulho'</code></pre>
<pre><code>The following object is masked from 'package:seewave':

    attenuation</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/maRce10/Rraven" class="external-link">Rraven</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># synthesize</span></span>
<span><span class="va">synth_est</span> <span class="op">&lt;-</span> <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/synth_sounds.html">synth_sounds</a></span><span class="op">(</span></span>
<span>  mar <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  frequencies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  durations <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  fm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  am <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sampling.rate <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code> [30msynthesizing sounds (step 0 of 0): [39m</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert into a single wave object</span></span>
<span><span class="va">synth_wav</span> <span class="op">&lt;-</span> <span class="fu">Rraven</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rraven/man/exp_est.html" class="external-link">exp_est</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">synth_est</span>,</span>
<span>                             single.file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             wave.object <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># plot spectro</span></span>
<span><span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>  wave <span class="op">=</span> <span class="va">synth_wav</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  palette <span class="op">=</span> <span class="va">viridis</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  osc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  colwave <span class="op">=</span> <span class="st">"#31688EB3"</span>,</span>
<span>  heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  wl <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="align_test_sounds_files/figure-html/unnamed-chunk-1-1.png" width="80%" style="display: block; margin: auto;"></p>
<p> </p>
<p>The function can add complexity to additional acoustic dimensions.
For instance the following code generates all possible combinations of
frequencies (2, 3 and 4 kHz), durations (0.1, and 0.2 s), frequency
modulation (tonal and modulated) and amplitude modulation (flat and
modulated envelope):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># synthesize</span></span>
<span><span class="va">synth_est2</span> <span class="op">&lt;-</span> <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/synth_sounds.html">synth_sounds</a></span><span class="op">(</span></span>
<span>  mar <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  sig2 <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  frequencies <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  durations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  fm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  am <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  sampling.rate <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert into a single wave object</span></span>
<span><span class="va">synth_wav2</span> <span class="op">&lt;-</span> <span class="fu">Rraven</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rraven/man/exp_est.html" class="external-link">exp_est</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">synth_est2</span>,</span>
<span>  single.file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wave.object <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot spectro</span></span>
<span><span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>  <span class="va">synth_wav2</span>,</span>
<span>  tlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  palette <span class="op">=</span> <span class="va">viridis</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  osc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  colwave <span class="op">=</span> <span class="st">"#31688EB3"</span>,</span>
<span>  heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  wl <span class="op">=</span> <span class="fl">140</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="align_test_sounds_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Note that the output is an extended selection table that contains the
time-frequency annotations for all synthetic sounds:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check first 6 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">synth_est2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.files
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
selec
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
start
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
end
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
bottom.freq
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
top.freq
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
frequency
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
duration
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
frequency.modulation
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
amplitude.modulation
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
treatment
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
replicate
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.id
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
synthetic_sound_1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
3.80
</td>
<td style="text-align:center;">
4.2
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.1
</td>
<td style="text-align:center;">
tonal
</td>
<td style="text-align:center;">
flat
</td>
<td style="text-align:center;">
dur:0.1;freq:4;tonal;flat
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
dur:0.1;freq:4;tonal;flat_1
</td>
</tr>
<tr>
<td style="text-align:center;">
synthetic_sound_2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.21
</td>
<td style="text-align:center;">
2.80
</td>
<td style="text-align:center;">
3.2
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.2
</td>
<td style="text-align:center;">
tonal
</td>
<td style="text-align:center;">
am
</td>
<td style="text-align:center;">
dur:0.2;freq:3;tonal;am
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
dur:0.2;freq:3;tonal;am_1
</td>
</tr>
<tr>
<td style="text-align:center;">
synthetic_sound_3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.21
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:center;">
5.0
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.2
</td>
<td style="text-align:center;">
fm
</td>
<td style="text-align:center;">
am
</td>
<td style="text-align:center;">
dur:0.2;freq:3;fm;am
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
dur:0.2;freq:3;fm;am_1
</td>
</tr>
<tr>
<td style="text-align:center;">
synthetic_sound_4
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
4.0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.1
</td>
<td style="text-align:center;">
fm
</td>
<td style="text-align:center;">
am
</td>
<td style="text-align:center;">
dur:0.1;freq:2;fm;am
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
dur:0.1;freq:2;fm;am_1
</td>
</tr>
<tr>
<td style="text-align:center;">
synthetic_sound_5
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
2.00
</td>
<td style="text-align:center;">
6.0
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.1
</td>
<td style="text-align:center;">
fm
</td>
<td style="text-align:center;">
flat
</td>
<td style="text-align:center;">
dur:0.1;freq:4;fm;flat
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
dur:0.1;freq:4;fm;flat_1
</td>
</tr>
<tr>
<td style="text-align:center;">
synthetic_sound_6
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.21
</td>
<td style="text-align:center;">
3.80
</td>
<td style="text-align:center;">
4.2
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.2
</td>
<td style="text-align:center;">
tonal
</td>
<td style="text-align:center;">
flat
</td>
<td style="text-align:center;">
dur:0.2;freq:4;tonal;flat
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
dur:0.2;freq:4;tonal;flat_1
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>As this is an extended selection table, the ‘sound.files’ column
refers to Wave objects included as attributes instead of files in a
directory:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check name of wave objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">synth_est2</span><span class="op">)</span><span class="op">$</span><span class="va">wave.objects</span><span class="op">)</span></span></code></pre></div>
<pre><code> [1] "synthetic_sound_1"  "synthetic_sound_2"  "synthetic_sound_3"  "synthetic_sound_4" 
 [5] "synthetic_sound_5"  "synthetic_sound_6"  "synthetic_sound_7"  "synthetic_sound_8" 
 [9] "synthetic_sound_9"  "synthetic_sound_10" "synthetic_sound_11" "synthetic_sound_12"
[13] "synthetic_sound_13" "synthetic_sound_14" "synthetic_sound_15" "synthetic_sound_16"
[17] "synthetic_sound_17" "synthetic_sound_18" "synthetic_sound_19" "synthetic_sound_20"
[21] "synthetic_sound_21" "synthetic_sound_22" "synthetic_sound_23" "synthetic_sound_24"</code></pre>
<p> </p>
</div>
<div class="section level2">
<h2 id="create-master-sound-file-for-playback">Create master sound file for playback<a class="anchor" aria-label="anchor" href="#create-master-sound-file-for-playback"></a>
</h2>
<p>The function <code><a href="../reference/master_sound_file.html">master_sound_file()</a></code> creates a master sound
file (as you probably guessed) for playback experiments. The function
takes wave objects from an data frame or (extended) selection table
containing the model sounds and concatenates them in a single sound file
(with some silence in between sounds which length can be modified).
<code><a href="../reference/master_sound_file.html">master_sound_file()</a></code> adds acoustic markers at the start and
end of the playback that can be used to time-sync re-recorded sounds,
which streamlines quantification of acoustic degradation. The following
example shows how to create a master sound file using the synthetic
sounds generated above. For the synthetic sounds we need to add a little
space between the top and bottom frequency because
<code>sim_songs()</code> make those values exactly the same for pure
tones:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create master sound file</span></span>
<span><span class="va">synth_master_annotations</span> <span class="op">&lt;-</span> <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/master_sound_file.html">master_sound_file</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">synth_est</span>,</span>
<span>  file.name <span class="op">=</span> <span class="st">"synthetic_master"</span>,</span>
<span>  dest.path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  gap.duration <span class="op">=</span> <span class="fl">0.15</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code> [30mThe file synthetic_master.wav has been saved in the directory path '/tmp/RtmpvlNO0t' [39m</code></pre>
<p> </p>
<p>The function saves the master sound file as a wave file and returns a
selection table in the R environment with the time and frequency
‘coordinates’ of the sounds in that file (be careful when playing the
master sound file as it can be shocking for some audiences!). We can
look at the spectrogram of the output file using the <a href="https://cran.r-project.org/package=seewave" class="external-link">seewave</a> function
<code>spectro()</code> as follows:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read wave file</span></span>
<span><span class="va">wave</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tuneR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/readWave.html" class="external-link">readWave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"synthetic_master.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot spectrogram</span></span>
<span><span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>  <span class="va">wave</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  palette <span class="op">=</span> <span class="va">viridis</span>,</span>
<span>  wl <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4.7</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="align_test_sounds_files/figure-html/spectro%20master%201-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>The function can also create a master sound file from sounds found in
sound files and from several sounds files, as is likely the case with
recordings collected in the field. The following example shows how to
create a master sound file using several sound files. The code uses the
example data and recordings from the package <a href="https://cran.r-project.org/package=warbleR" class="external-link">warbleR</a>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load example data from warbleR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Phae.long1"</span>,</span>
<span>  <span class="st">"Phae.long2"</span>,</span>
<span>  <span class="st">"Phae.long3"</span>,</span>
<span>  <span class="st">"Phae.long4"</span>,</span>
<span>  <span class="st">"lbh_selec_table"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save sound files to temporary folder</span></span>
<span><span class="fu">writeWave</span><span class="op">(</span><span class="va">Phae.long1</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long1.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">writeWave</span><span class="op">(</span><span class="va">Phae.long2</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long2.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">writeWave</span><span class="op">(</span><span class="va">Phae.long3</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long3.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">writeWave</span><span class="op">(</span><span class="va">Phae.long4</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long4.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make an extended selection table</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">warbleR</span><span class="fu">::</span><span class="fu"><a href="https://marce10.github.io/warbleR/reference/selection_table.html" class="external-link">selection_table</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">lbh_selec_table</span>,</span>
<span>  extended <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  pb <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code> [30mall selections are OK 
 [39m</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add sound_id column</span></span>
<span><span class="va">est</span><span class="op">$</span><span class="va">sound.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/abbreviate.html" class="external-link">abbreviate</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span>, <span class="va">est</span><span class="op">$</span><span class="va">selec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create master sound file</span></span>
<span><span class="va">master_annotations</span> <span class="op">&lt;-</span> <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/master_sound_file.html">master_sound_file</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">est</span>,</span>
<span>  file.name <span class="op">=</span> <span class="st">"example_master"</span>,</span>
<span>  dest.path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  gap.duration <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code> [30mThe file example_master.wav has been saved in the directory path '/tmp/RtmpvlNO0t' [39m</code></pre>
<p> </p>
<p>Again, we can look at the spectrogram of the output file:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read wave file</span></span>
<span><span class="va">wave</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tuneR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/readWave.html" class="external-link">readWave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"example_master.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot spectrogram</span></span>
<span><span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>  <span class="va">wave</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  palette <span class="op">=</span> <span class="va">viridis</span>,</span>
<span>  collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  wl <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="align_test_sounds_files/figure-html/spectro%20master%202-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Note that the output could also be exported to <a href="https://www.ravensoundsoftware.com/software/raven-pro/" class="external-link">Raven
sound analysis software</a> (<a href="https://www.birds.cornell.edu/home" class="external-link">Cornell Lab of
Ornithology</a>) for visualization or further manipulation using the
function <code><a href="https://rdrr.io/pkg/Rraven/man/exp_raven.html" class="external-link">exp_raven()</a></code> from the <a href="https://cran.r-project.org/package=Rraven" class="external-link">Rraven</a> package.
<code><a href="https://rdrr.io/pkg/Rraven/man/exp_raven.html" class="external-link">exp_raven()</a></code> exports selections in the R environment to a
‘.txt’ file that can be read in Raven:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rraven</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rraven/man/exp_raven.html" class="external-link">exp_raven</a></span><span class="op">(</span><span class="va">master_annotations</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  file.name <span class="op">=</span> <span class="st">"example_master_selection_table"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<p>Both sound files and annotations can be visualized in Raven (
acoustic analysis software):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"example_master_table.jpg"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_master_table.jpg" width="80%" style="display: block; margin: auto;"></p>
<p> </p>
<p>Take a look at the <a href="https://CRAN.R-project.org/package=Rraven/vignettes/Rraven.html" class="external-link">Rraven
vignette</a> for more details on how to export and import data from R to
Raven.</p>
<p>Note that the start and end markers are placed at relatively low
frequencies so they are less affected by degradation. The frequency
range of markers can be set with argument <code>flim</code>. The
relative amplitude of markers can also be adjusted with the
<code>amp.marker</code> argument. Amplitude of markers will be
multiplied by the value supplied so markers will be louder than sounds.
These two features should increases the chances of detecting the markers
at further distances.</p>
</div>
<div class="section level2">
<h2 id="align-re-recorded-sounds">Align re-recorded sounds<a class="anchor" aria-label="anchor" href="#align-re-recorded-sounds"></a>
</h2>
<p>Once we went to the field (or lab) and re-recorded the master sound
files at different distances, we are ready to start with data analysis.
The first step for getting the data ready for analysis involves finding
sounds within the re-recorded sound files. We only need to align the
start marker between the master playback and the re-recorded sound
files, based on the fact that the time difference between the marker and
the sounds should be the same in both cases:</p>
<center>
<img src="align-crop-optimize.gif" alt="Align recordings diagram" width="550">
</center>
<p> </p>
<p>We will use acoustic data included in the package as example data.
This is a data subset from a sound transmission experiment. The complete
data set of the experiment is hosted in <a href="https://figshare.com/articles/media/baRulho_an_R_package_to_quantify_animal_acoustic_signal_transmission_and_degradation/21559074" class="external-link">this
repository</a>. There are two example objects that will be used:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"master_est"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"test_sounds_est"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<p>These are the files contained in the data set:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">master_est</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "master.wav"</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">test_sounds_est</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "10m_closed.wav" "10m_open.wav"   "1m_open.wav"    "30m_closed.wav" "30m_open.wav"  </code></pre>
<p> </p>
<p>Their names are self-explanatory: a master sound file (“master.wav”)
and its annotations, a reference sound file (“reference_1m.wav”) and two
test files (“test_10m.wav” and “test_20m.wav”) re-recorded at 10 and 20
m respectively.</p>
<p>Now we will save those files in a temporary working directory (those
objects are extended selection tables in the R environment) to resemble
the usual case in which the acoustic data is found in sound files.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first remove any other wave file in the temporary working directory (dont do it with your data!)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  full.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">".wav"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save master sound file</span></span>
<span><span class="fu">writeWave</span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">master_est</span>, <span class="st">"wave.objects"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"master.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save test sound files</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">test_sounds_est</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">writeWave</span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">test_sounds_est</span>, <span class="st">"wave.objects"</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># make annotations a data frame</span></span>
<span><span class="va">master_annotations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">master_est</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<p>The annotations needed for aligning test sound must share the
following structure:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master_annotations</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.files
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
selec
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
start
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
end
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
bottom.freq
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
top.freq
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.id
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
transect
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
distance
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
master.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.050000
</td>
<td style="text-align:center;">
0.200000
</td>
<td style="text-align:center;">
1.333333
</td>
<td style="text-align:center;">
2.666667
</td>
<td style="text-align:center;">
ambient
</td>
<td style="text-align:center;">
master
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
master.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.250000
</td>
<td style="text-align:center;">
1.250000
</td>
<td style="text-align:center;">
1.333333
</td>
<td style="text-align:center;">
2.666667
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
master
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
master.wav
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1.300000
</td>
<td style="text-align:center;">
1.500023
</td>
<td style="text-align:center;">
7.875000
</td>
<td style="text-align:center;">
8.805000
</td>
<td style="text-align:center;">
freq:9
</td>
<td style="text-align:center;">
master
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
master.wav
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1.550023
</td>
<td style="text-align:center;">
1.750045
</td>
<td style="text-align:center;">
3.208000
</td>
<td style="text-align:center;">
4.069000
</td>
<td style="text-align:center;">
freq:4
</td>
<td style="text-align:center;">
master
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
master.wav
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
1.800045
</td>
<td style="text-align:center;">
2.000068
</td>
<td style="text-align:center;">
0.422000
</td>
<td style="text-align:center;">
1.223000
</td>
<td style="text-align:center;">
freq:1
</td>
<td style="text-align:center;">
master
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
master.wav
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
2.050068
</td>
<td style="text-align:center;">
2.250091
</td>
<td style="text-align:center;">
6.905000
</td>
<td style="text-align:center;">
7.917000
</td>
<td style="text-align:center;">
freq:7
</td>
<td style="text-align:center;">
master
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>Note the ‘sound.id’ column which contains a unique identifier for
each sound. This will be used to label their counterparts in the test
sound files. Users can import annotations from <a href="https://www.ravensoundsoftware.com/software/raven-pro/" class="external-link">Raven</a>
using the <a href="https://cran.r-project.org/package=Rraven" class="external-link">Rraven</a>
package (<a href="https://CRAN.R-project.org/package=Rraven/vignettes/Rraven.html" class="external-link">see
this vignette</a>).</p>
<p>To find the location of the start marker on the test sound files we
use the functions <code><a href="../reference/find_markers.html">find_markers()</a></code> to run a cross-correlation
of one or more markers across the test files in order to determine the
exact time in which each marker is found:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">markers_position</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/find_markers.html">find_markers</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">master_annotations</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">markers_position</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.files
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
selec
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
start
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
end
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
scores
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
marker
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
time.mismatch
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.2575707
</td>
<td style="text-align:center;">
1.257571
</td>
<td style="text-align:center;">
0.6363941
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
0.010475
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2.3181364
</td>
<td style="text-align:center;">
3.318136
</td>
<td style="text-align:center;">
0.4522408
</td>
<td style="text-align:center;">
end_marker
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_open.wav
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.2575707
</td>
<td style="text-align:center;">
1.257571
</td>
<td style="text-align:center;">
0.7394769
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
-2.213999
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_open.wav
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.0936621
</td>
<td style="text-align:center;">
1.093662
</td>
<td style="text-align:center;">
0.2479998
</td>
<td style="text-align:center;">
end_marker
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
1m_open.wav
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0.2575707
</td>
<td style="text-align:center;">
1.257571
</td>
<td style="text-align:center;">
0.8043774
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
0.010475
</td>
</tr>
<tr>
<td style="text-align:center;">
1m_open.wav
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
2.3181364
</td>
<td style="text-align:center;">
3.318136
</td>
<td style="text-align:center;">
0.8409873
</td>
<td style="text-align:center;">
end_marker
</td>
<td style="text-align:center;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>The position of the markers is determined as the highest spectrogram
cross-correlation value for each marker using the functions
<code><a href="../reference/find_markers.html">find_markers()</a></code>. If two or more markers are used the
function computes an additional column, ‘time.mismatch’, that compares
the time difference between the two markers in the test files against
that in the master sound file. In a perfect detection the value must be
0. So this number can be used as a measure of error. In some cases
precision can improve by increasing the time resolution of the
spectrogram, that is, by lowering the size of the time window. This is
done with the argument ‘hop.size’. By default it is 11.6 ms (which is
equivalent to a 512 samples window length in a 44.1 kHz file). Let’s try
4 ms:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lower window length</span></span>
<span><span class="va">markers_position</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/find_markers.html">find_markers</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">master_annotations</span>,</span>
<span>                        hop.size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                        path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">markers_position</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.files
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
selec
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
start
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
end
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
scores
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
marker
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
time.mismatch
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.2520095
</td>
<td style="text-align:center;">
1.252009
</td>
<td style="text-align:center;">
0.6135088
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
0.0019868
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2.3040871
</td>
<td style="text-align:center;">
3.304087
</td>
<td style="text-align:center;">
0.4125830
</td>
<td style="text-align:center;">
end_marker
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_open.wav
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.2520095
</td>
<td style="text-align:center;">
1.252009
</td>
<td style="text-align:center;">
0.8155176
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
-2.0940924
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_open.wav
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.2080079
</td>
<td style="text-align:center;">
1.208008
</td>
<td style="text-align:center;">
0.2664834
</td>
<td style="text-align:center;">
end_marker
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
1m_open.wav
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0.2520095
</td>
<td style="text-align:center;">
1.252009
</td>
<td style="text-align:center;">
0.9124979
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
-0.0020133
</td>
</tr>
<tr>
<td style="text-align:center;">
1m_open.wav
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
2.3000869
</td>
<td style="text-align:center;">
3.300087
</td>
<td style="text-align:center;">
0.6832009
</td>
<td style="text-align:center;">
end_marker
</td>
<td style="text-align:center;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>With the time location of acoustic markers we can infer the position
of all other sounds in the new recordings. A selection table from
re-recorded files can be generated using the function
<code><a href="../reference/align_test_files.html">align_test_files()</a></code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_tests</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/align_test_files.html">align_test_files</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">master_annotations</span>,</span>
<span>    Y <span class="op">=</span> <span class="va">markers_position</span>,</span>
<span>    by.song <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    remove.markers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p> </p>
<p>The function returns an object of the same class of the input object
‘X’. In this case ‘X’ is an <code>data.frame</code>:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">aligned_tests</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_tests</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.files
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
selec
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
start
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
end
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
bottom.freq
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
top.freq
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
sound.id
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
marker
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.0520095
</td>
<td style="text-align:center;">
0.2020095
</td>
<td style="text-align:center;">
1.333333
</td>
<td style="text-align:center;">
2.666667
</td>
<td style="text-align:center;">
ambient
</td>
<td style="text-align:center;">
start_marker
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.2520095
</td>
<td style="text-align:center;">
1.2520095
</td>
<td style="text-align:center;">
1.333333
</td>
<td style="text-align:center;">
2.666667
</td>
<td style="text-align:center;">
start_marker
</td>
<td style="text-align:center;">
start_marker
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1.3020095
</td>
<td style="text-align:center;">
1.5020322
</td>
<td style="text-align:center;">
7.875000
</td>
<td style="text-align:center;">
8.805000
</td>
<td style="text-align:center;">
freq:9
</td>
<td style="text-align:center;">
start_marker
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1.5520322
</td>
<td style="text-align:center;">
1.7520549
</td>
<td style="text-align:center;">
3.208000
</td>
<td style="text-align:center;">
4.069000
</td>
<td style="text-align:center;">
freq:4
</td>
<td style="text-align:center;">
start_marker
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
1.8020549
</td>
<td style="text-align:center;">
2.0020776
</td>
<td style="text-align:center;">
0.422000
</td>
<td style="text-align:center;">
1.223000
</td>
<td style="text-align:center;">
freq:1
</td>
<td style="text-align:center;">
start_marker
</td>
</tr>
<tr>
<td style="text-align:center;">
10m_closed.wav
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
2.0520776
</td>
<td style="text-align:center;">
2.2521002
</td>
<td style="text-align:center;">
6.905000
</td>
<td style="text-align:center;">
7.917000
</td>
<td style="text-align:center;">
freq:7
</td>
<td style="text-align:center;">
start_marker
</td>
</tr>
</tbody>
</table>
</div>
<p>We can check the precision of the alignment by looking at the
spectrograms. The function <code><a href="../reference/plot_aligned_sounds.html">plot_aligned_sounds()</a></code> can create
spectrograms to visually inspect alignment precision on test sound
files. The spectrograms are saved as individual JPEG image files (in
‘dest.path’ if supplied). One file is created for each sound file:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_imgs</span> <span class="op">&lt;-</span> <span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_aligned_sounds.html">plot_aligned_sounds</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">aligned_tests</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dest.path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  duration <span class="op">=</span> <span class="fl">2.4</span>,</span>
<span>  ovlp <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code> [30mThe image files have been saved in the directory path '/tmp/RtmpvlNO0t' [39m</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_imgs</span></span></code></pre></div>
<pre><code>[1] "/tmp/RtmpvlNO0t/plot_align_10m_closed.jpeg" "/tmp/RtmpvlNO0t/plot_align_10m_open.jpeg"  
[3] "/tmp/RtmpvlNO0t/plot_align_1m_open.jpeg"    "/tmp/RtmpvlNO0t/plot_align_30m_closed.jpeg"
[5] "/tmp/RtmpvlNO0t/plot_align_30m_open.jpeg"  </code></pre>
<p>These are two of the files generated by the code above:</p>
<p><img src="plot_align_10m_closed.jpeg" width="80%" style="display: block; margin: auto;"><img src="plot_align_30m_closed.jpeg" width="80%" style="display: block; margin: auto;"></p>
<p> </p>
<div class="section level3">
<h3 id="manually-fixing-alignment">Manually fixing alignment<a class="anchor" aria-label="anchor" href="#manually-fixing-alignment"></a>
</h3>
<p>In some cases alignments might not be accurate, particularly when
markers have been considerably degraded on the test sound files. The
function <code><a href="../reference/manual_realign.html">manual_realign()</a></code> allows users to interactively
adjust the alignment of test sound files produced by
<code><a href="../reference/align_test_files.html">align_test_files()</a></code>. The function generates a multipanel
graph with the spectrogram of the master sound file in top of that from
test sound files, highlighting the position of correspondent test sounds
on both in order to simplify assessing and adjusting their
alignment:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">baRulho</span><span class="fu">::</span><span class="fu"><a href="../reference/manual_realign.html">manual_realign</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">aligned_tests</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">master_annotations</span>,</span>
<span>  duration <span class="op">=</span> <span class="fl">2.4</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="manual_realign.gif" width="80%" style="display: block; margin: auto;"><!-- <img src="/home/runner/work/baRulho/baRulho/vignettes/manual_realign.gif" alt="manual realign"> --></p>
<p>Spectrograms include the first few seconds of the sound files
(controlled by ‘duration’) which is usually enough to tell the precision
of the alignment. The lower spectrogram shows a series of ‘buttons’ that
users can click on to control if the test sound file spectrogram (low
panel) needs to be moved to the left (“&lt;”) or right (“&gt;”). Users
can also reset the spectrogram to its original position (‘reset’), move
on to the next sound file in ‘X’ (test sound file annotations) or stop
the process (stop button). The function returns an object similar to the
input object ‘X’ in which the start and end of the sounds have been
adjusted. By default it uses the start marker as reference but this can
be modified with the argument ‘marker’.</p>
</div>
<div class="section level3">
<h3 id="further-aligning">Further aligning<a class="anchor" aria-label="anchor" href="#further-aligning"></a>
</h3>
<p>When alignments are done manually (or when broadcasting devices add
some short delays as the case of some bluetooth transmitters) there
could be some small misalignment between the inferred versus the actual
start time of re-recorded sounds. This is problematic for quantifying
degradation in <a href="https://docs.ropensci.org/baRulho//" class="external-link">baRulho</a>
(and other sound analysis software) as precise alignment of sound is
crucial for the accuracy of downstream measures of sound
degradation.</p>
<p>Misalignment can be fixed with the function
<code><a href="../reference/auto_realign.html">auto_realign()</a></code>. This function uses spectrogram
cross-correlation to sync the position in time of sounds with regard to
a reference sound. <code><a href="../reference/manual_realign.html">manual_realign()</a></code> takes the sound
recorded at the closest distance to the source as the reference sound.
The function calls <a href="https://cran.r-project.org/package=warbleR" class="external-link">warbleR</a>’s
<code><a href="https://marce10.github.io/warbleR/reference/cross_correlation.html" class="external-link">cross_correlation()</a></code> (just as we did above) internally to
align sounds using cross-correlation. We can simulate a aligned data set
in which test sound are slightly off their position:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"test_sounds_est"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"master_est"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># create "unaligned_test_sounds_est" by</span></span>
<span>  <span class="co"># adding error to "test_sounds_est" start and end</span></span>
<span>  <span class="va">unaligned_test_sounds_est</span> <span class="op">&lt;-</span> <span class="va">test_sounds_est</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">noise_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.009</span>, <span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.03</span>, <span class="op">-</span><span class="fl">0.03</span>, <span class="fl">0</span>, <span class="fl">0.07</span>, <span class="op">-</span><span class="fl">0.007</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">unaligned_test_sounds_est</span><span class="op">)</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">unaligned_test_sounds_est</span>, <span class="st">"check.res"</span><span class="op">)</span><span class="op">$</span><span class="va">start</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">unaligned_test_sounds_est</span><span class="op">$</span><span class="va">start</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">unaligned_test_sounds_est</span><span class="op">$</span><span class="va">start</span> <span class="op">+</span> <span class="va">noise_time</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">unaligned_test_sounds_est</span>, <span class="st">"check.res"</span><span class="op">)</span><span class="op">$</span><span class="va">end</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">unaligned_test_sounds_est</span><span class="op">$</span><span class="va">end</span>  <span class="op">&lt;-</span> </span>
<span>  <span class="va">unaligned_test_sounds_est</span><span class="op">$</span><span class="va">end</span> <span class="op">+</span> <span class="va">noise_time</span></span></code></pre></div>
<p>Now we can re-aligned test sounds:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#re align</span></span>
<span><span class="va">rts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_realign.html">auto_realign</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">unaligned_test_sounds_est</span>, Y <span class="op">=</span> <span class="va">master_est</span><span class="op">)</span></span></code></pre></div>
<p>This is how the sounds look before and after being aligned:</p>
<center>
<img src="auto_realign_results.gif" alt="time sync with manual_realign">
</center>
<p> </p>
<p>In case this doesn’t work as expected there is another option. The
function <code>seltailor()</code> from <a href="https://cran.r-project.org/package=warbleR" class="external-link">warbleR</a> allows
user to manually adjust the start and end of sounds in a extended
selection table. Alternatively, users can manually determined the
position of the the markers using <a href="https://www.ravensoundsoftware.com/software/raven-pro/" class="external-link">Raven</a>
and then import the annotations into ‘R’ using the function
‘imp_raven()’ from the <a href="https://cran.r-project.org/package=Rraven" class="external-link">Rraven</a> package.</p>
<p> </p>
<hr>
<p>Please report any bugs <a href="https://github.com/ropensci/baRulho/issues" class="external-link">here</a>.</p>
<p>The package <a href="https://docs.ropensci.org/baRulho//" class="external-link">baRulho</a>
should be cited as follows:</p>
<p>Araya-Salas, M. (2020), <em>baRulho: quantifying degradation of
(animal) acoustic signals in R</em>. R package version 1.0.0.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Araya-Salas, M. (2017). <em>Rraven: connecting R and Raven
bioacoustic software</em>. R package version 1.0.0.</p></li>
<li><p>Araya-Salas, M. (2020), <em>baRulho: quantifying degradation of
(animal) acoustic signals in R</em>. R package version 1.0.0</p></li>
<li><p>Araya-Salas M, Smith-Vidaurre G. (2017) <em>warbleR: An R package
to streamline analysis of animal acoustic signals</em>. Methods Ecol
Evol 8:184–191.</p></li>
<li><p>Dabelsteen, T., Larsen, O. N., &amp; Pedersen, S. B. (1993).
<em>Habitat-induced degradation of sound signals: Quantifying the
effects of communication sounds and bird location on blur ratio, excess
attenuation, and signal-to-noise ratio in blackbird song</em>. The
Journal of the Acoustical Society of America, 93(4), 2206.</p></li>
<li><p>Marten, K., &amp; Marler, P. (1977). <em>Sound transmission and
its significance for animal vocalization. Behavioral</em> Ecology and
Sociobiology, 2(3), 271-290.</p></li>
<li><p>Morton, E. S. (1975). <em>Ecological sources of selection on
avian sounds</em>. The American Naturalist, 109(965), 17-34.</p></li>
<li><p>Tobias, J. A., Aben, J., Brumfield, R. T., Derryberry, E. P.,
Halfwerk, W., Slabbekoorn, H., &amp; Seddon, N. (2010). <em>Song
divergence by sensory drive in Amazonian birds</em>. Evolution, 64(10),
2820-2839.</p></li>
</ol>
<hr>
<p><font size="4">Session information</font></p>
<pre><code>R version 4.4.2 (2024-10-31)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 24.04.1 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        LC_COLLATE=C.UTF-8    
 [5] LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    LC_PAPER=C.UTF-8       LC_NAME=C             
 [9] LC_ADDRESS=C           LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   

time zone: UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] Rraven_1.0.14      baRulho_2.1.3      ohun_1.0.2         warbleR_1.1.34     NatureSounds_1.0.5
 [6] seewave_2.2.3      tuneR_1.4.7        viridis_0.6.5      viridisLite_0.4.2  knitr_1.49        

loaded via a namespace (and not attached):
 [1] gtable_0.3.6       rjson_0.2.23       xfun_0.50          bslib_0.8.0        ggplot2_3.5.1     
 [6] vctrs_0.6.5        tools_4.4.2        bitops_1.0-9       curl_6.1.0         parallel_4.4.2    
[11] tibble_3.2.1       proxy_0.4-27       pkgconfig_2.0.3    KernSmooth_2.23-24 checkmate_2.3.2   
[16] desc_1.4.3         lifecycle_1.0.4    stringr_1.5.1      compiler_4.4.2     textshaping_1.0.0 
[21] brio_1.1.5         munsell_0.5.1      htmltools_0.5.8.1  class_7.3-22       sass_0.4.9        
[26] RCurl_1.98-1.16    yaml_2.3.10        pillar_1.10.1      pkgdown_2.1.1      jquerylib_0.1.4   
[31] MASS_7.3-61        classInt_0.4-11    cachem_1.1.0       Deriv_4.1.6        digest_0.6.37     
[36] stringi_1.8.4      sf_1.0-19          fastmap_1.2.0      grid_4.4.2         colorspace_2.1-1  
[41] cli_3.6.3          magrittr_2.0.3     e1071_1.7-16       scales_1.3.0       backports_1.5.0   
[46] rmarkdown_2.29     httr_1.4.7         Sim.DiffProc_4.9   signal_1.8-1       igraph_2.1.3      
[51] gridExtra_2.3      png_0.1-8          ragg_1.3.3         kableExtra_1.4.0   pbapply_1.7-2     
[56] evaluate_1.0.3     dtw_1.23-1         fftw_1.0-9         testthat_3.2.3     rlang_1.1.5       
[61] Rcpp_1.0.14        glue_1.8.0         DBI_1.2.3          xml2_1.3.6         svglite_2.1.3     
[66] rstudioapi_0.17.1  jsonlite_1.8.9     R6_2.5.1           systemfonts_1.2.1  fs_1.6.5          
[71] units_0.8-5       </code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marcelo Araya-Salas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
